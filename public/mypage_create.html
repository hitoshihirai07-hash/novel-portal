<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Novel Portal</title>
  
  <meta property="og:title" content="Novel Portal - マイページ作成">
  <meta property="og:description" content="編集キーを作成します">
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="Novel Portal">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Novel Portal - マイページ作成">
  <meta name="twitter:description" content="編集キーを作成します">
<link rel="icon" href="/favicon.svg" />
  <link rel="stylesheet" href="/assets/style.css" />
</head>
<body>
<header>
  <div class="header-inner">
    <div class="brand">
      <h1>Novel Portal</h1>
      <small>最小構成</small>
    </div>
    <nav>
      <a href="/">トップ</a>
      <a href="/post.html">投稿</a>
      <a href="/my.html">マイページ</a>
      <a href="/mypage_create.html">マイページ作成</a>
    </nav>
  </div>
</header>
<main>

<div class="card">
  <div class="row" style="justify-content:space-between;align-items:flex-end">
    <div>
      <h2 style="margin:0 0 6px">マイページ作成</h2>
      <div class="notice" id="msg" style="display:none"></div>
    </div>
    <span class="badge">作成</span>
  </div>
  <hr />
  <div class="grid two">
    <div>
      <label>表示名</label>
      <input id="name" placeholder="例：Hitoshi" />
    </div>
    <div>
      <label>招待コード</label>
      <input id="invite" placeholder="招待コード" />
    </div>
  </div>
  <div class="row" style="margin-top:12px">
    <button class="btn" id="createBtn">作成</button>
  </div>
</div>

<div style="height:12px"></div>

<div class="card">
  <h3 style="margin-top:0">発行された編集キー</h3>
  <div class="notice" id="keyWrap" style="display:none">
    <div class="row">
      <span class="kbd" id="key"></span>
      <button class="btn secondary" id="copyBtn">コピー</button>
    </div>
  </div>
</div>

</main>
<div class="footer">© Novel Portal</div>
<script type="module">

import { qs, apiPost, setEditKey, showMsg, setBusy } from "/assets/app.js";

qs("#createBtn").addEventListener("click", async ()=>{
  showMsg("#msg", "");
  qs("#keyWrap").style.display = "none";
  const btn = qs("#createBtn");
  setBusy(btn, true);
  try{
    const name = qs("#name").value.trim();
    const invite = qs("#invite").value.trim();
    const data = await apiPost("/api/signup", { name, invite });
    qs("#key").textContent = data.edit_key || "";
    qs("#keyWrap").style.display = "block";
    // also save to browser for convenience (no explanation shown)
    if (data.edit_key) setEditKey(data.edit_key);
  }catch(e){
    showMsg("#msg", e.message || "作成に失敗しました", true);
  }finally{
    setBusy(btn, false, "作成");
  }
});

qs("#copyBtn").addEventListener("click", async ()=>{
  const t = qs("#key").textContent;
  try{ await navigator.clipboard.writeText(t); }catch{}
});

</script>
</body>
</html>
